### 流量反作弊

流量反作弊对于精度的要求尤其高，多过滤导致平台收益减少、少过滤引起广告主投诉，破坏投放生态。而且业务场景对实时返款的诉求越来越强烈，同时作弊对抗升级，从集中式、大规模转向分布式、稀疏化攻击，识别难度增大。亟需给予高维异常检查的新系统能力。为此，建立及**异常主动感知、人工洞察分析、自动处置过滤、客观评价**高效循环一体的风控系统

![图片](https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvglLmsNT0qLkV8oHicclclia183aoKuYHGy3EaQGzgT21YPx81HAXFWE0g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

#### 1.感知

在历史的风控体系中，往往是case驱动的。即遇到问题通过滞后的算法或策略迭代来覆盖风险，为来提前发现问题，尽可能减少投诉，净化投放环境，我们引入了感知，通过感知捕捉与常见分布不同的数据，输出异常列表

将可感知异常流量分为

1. 受害者可感知
2. 平台可感知
3. 实战攻防可感知
4. 假想攻防可感知
5. 算法挖掘可感知

感知是重召回的，但并不是单纯为了更多地召回现有风险。设计的核心是去感知所有的“异常”。有时因为政策或外部环境影响，部分连带指标会发现异常，这些异常是商家可感知的，需要被我们捕捉到。但并不属于作弊流量，所以不会被流量反作弊系统所过滤。

<img src="https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvgpaMiave0KDkQMZ02SOS583KVP8IMLw4rCViamoViaeQoac15atOwn2ibFQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" style="zoom:67%;" />

那感知究竟如何来做呢？以“点击流量反作弊”来说，**作弊一定会导致点击量增加**。如果可以预估出一个商品每天的点击数量。则超出该值的点击一定为作弊。因此流量反作弊感知的核心之一，就是**如何在大盘召回率未知的情况下，精准预估正常流量值**。



#### 2.洞察

为了确认感知到的异常流量哪些属于作弊，分析人员需要进行洞察分析。“洞察”的目的从“感知”到的异常中将风险抽离出来，进而发现新的风险模式。将洞察分为：

1. 受害者洞察
2. 攻击者洞察
3. 套利漏洞洞察
4. 流量实例洞察

传统洞察需要人工挑选可疑特征，如停留时长、注册时长，并与大盘好样本进行比较。这对看领域经验有强依赖，专家较少，并且随着作弊越发高级，单一维度或少量维度逐渐难以发现作弊。为此，引入高维数据下的可视化洞察分析技术

<img src="https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvgPMjvcyDNuzqBFs96fIT1NS95icOibYy3VoVKG47ModCg0fKia4ibQhbPQw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" style="zoom:50%;" />

在洞察环节，首先需要对样本进行高度抽象表示，如何在高维数据中选择合适的子空间投影，是非常具有挑战性的课题。确定合适的子空间后，除了和大盘比较，还引入了时间维度的分布同比，对于分布稳定的某个广告，3月6日降维图中突然出现明显不同的一簇（红圈内），很可能是新的异常模式

![图片](https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvgwgxibFQ02KxTVtqzDhLYP8x08mbdjykhzuVIEm18KBXYQBFCwXtmzcA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

洞察的难点在于，如何减轻未召回的作弊对正常分布的污染，比如上图中蓝色线条内部分可能也存在作弊，这时通过同比就无法发现异常。如何跳出既有认知去召回未知异常模式，以及非常棘手的冷启动问题



#### 3.处置

处置，指对风险进行处置，对于不同的风险实体、风险类型，会使用不同的处置方法

##### 3.1 流量反作弊的处置

传统的算法迭代模式，是根据洞察分析的结果，指导规则、统计模型为主的无监督过滤系统。对领域经验比较依赖，而且效率低下、难以形成沉淀。因此，对于流量反作弊的处置，我们部署了实时流式、小时批处理双重防线

<img src="https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvgyibPvuPV0vmWzjwSwftEdQWyXiaEJosxZxqUOyWANHEQLDMxuia6AP29g/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" style="zoom:67%;" />

在线实时过滤系统，综合了**无监督、半监督的特征工程，以及监督的集成（Ensemble）异常检测器**。相比于单条策略的独立决策，集成的容错性更高（召回能力下降，适用于精度高的场景）。例如，PC端反作弊策略依赖于网页采集的前端行为、鼠标点击行为等，当数据采集出错时，过渡依赖某一策略将导致大面积误差。

同时，**我们会尽可能使用更触及作弊本质、更具有鲁棒性的特征**。和正向业务不同，我们不会在特征设计层面，过分聚焦于正样本的区分度。比如绝大部分爬虫流量都是PC端带来的，“是否是PC”就是一个极强的特征。但一旦这种作弊没有继续攻击，模型的效果就大打折扣。因此更多会使用各个维度上计算与Normal分布的偏差、到Normal簇的距离...等

实时过滤系统基本可以解决90%的问题。为了更好地拟合高级作弊，我们又引入了小时级别过滤系统，使用开销更大的特征与更复杂的模型。而且广告结算支持事后返款，可以使用小时级结果对实时流模型进行修正，用于结算与展示

##### 3.2 淘客交易反作弊的处置

对于过滤系统判定作弊的淘客，我们首先冻结其佣金。搜集证据后下达处罚结果。并通过“预估佣金”、“异常特征”来对待处罚淘客进行分级处置。

<img src="https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvgvBrzU03aI34EKygTJoqheRPey31uG0cmT5GhliaEeZhhKiaGxibMe7u2A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" style="zoom:50%;" />

此外，传统的处罚机制为月结，从媒体开始作弊到下达处罚有一定延迟。一方面不利于及时管控风险，另一方面会导致非主观恶意作弊淘客的强烈反弹，为提升管控的时效，减少淘客的损失，同时提升用户体验，我们在原有的月结机制基础上，增加周/天的处罚机制。



#### 4.评价

对于整个流量反作弊系统，我们有4部分需要评价

1. 在线有监督精度
2. 在线有监督召回
3. 离线无监督精度
4. 离线无监督召回

因为没有Ground Truth，为了客观评价在线有监督过滤系统的**精度**与**召回**，我们建立了**离线无监督样本库**。使用离线无监督样本库的最终结果，作为在线有监督系统的Groud truth，就可以评估其分类效果。但也引入了后面2部分无监督评价问题。

1. 有监督过滤系统的评价

   在线与离线2者的关系。基于纯无监督的挖掘体系，我们的底线是消灭5种可感知异常流量中的作弊流量，终局则是消灭不可感知的作弊流量。通过天级别的事后信息引入，以无监督的方式对线上实时系统过滤结果进行修正，并将标签用于后续在线监督系统学习。

   ![图片](https://mmbiz.qpic.cn/mmbiz_png/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvg5VIovPzXw1nN5XmnRiaPZRfBztG8bRhvWwgGkmicnZ7jo7CtbQN4lvkw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

基于现有标签的AUC、KS、MAX-F1...等指标，会过分高估风控模型效果。例如，实时模型的AUC很容易高于0.99。然而这其中绝大多数的样本都来自于简单的爬虫、或傻瓜式疯狂点击，如下图离散分布的红点。在更高级的作弊上AUC可能不足0.8，如下图红圈中的样本。为了更客观地评价模型，我们引入了“**样本库分级**”，将**“简单作弊”**与**“高级作弊”**区分开。并通过结构化采样构造封闭评测集，指导模型迭代。

<img src="https://mmbiz.qpic.cn/mmbiz_jpg/0bUHKeoZbc7X72PJjDkGoswgdMzqsPvghUcZM4BmhofQmRWgmPEARcOlGw8vFia3KtdcEyApcyDDUTicVv3CtgJA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" style="zoom:33%;" />

2. 无监督精准评价

   无监督系统的精准与召回评价一直是业内的难题，传统的评价方法是通过数据抽样，有专家进行标注进行评估。效率低下且非常主观。借助淘系生态数据，未无监督系统引入自动化评价体系。基于无效流量转化概率为0的假设，通过统计推断，得到模型在指定置信度下的精度指数下限

3. 无监督召回评价

   真实环境下的召回评价，是难以定量的。除了大盘抽检巡检外，由于引入了完备的感知、洞察体系。将所有的异常流量，均归纳至一个风险池。无论何时有需要对流量进行 处置（临时止血或迭代模型），我们都可以迅速定位到问题根源，于是将安全感最大化。



### 总结

高维数据下的异常检测、大规模图学习、机器学习可解释性、数据可视化方法等，都是我们的重点研究方向。在我们看来，风控可能是当前机器学习领域，对算法鲁棒性和解释性要求最高、精度要求最极致、系统规模和时效性挑战最大、最能用钱衡量的工业级业务。这就需要我们具备卓越的业务数据洞察能力、工程架构能力，让研究成果转换成坚实的工业级解决方案。